# Improved Polka Init Guide

The `polka init` command has been enhanced to support AI-powered interactive script generation with user confirmation and planning.

## Overview

The `polka init` command now supports four modes:

1. **Config Initialization** - Generate project configuration
2. **Basic Script Template** - Create simple script templates
3. **AI-Assisted Script Generation** - Generate custom scripts with AI help
4. **Skill Creation** - Create Agent Skills

## Usage Modes

### 1. Config Initialization

Initialize or update polkacodes configuration:

```bash
# Interactive mode (recommended for first time)
bun run polka init

# Non-interactive
bun run polka init --yes

# Global config
bun run polka init -g
```

The AI will:
- Analyze your project structure
- Detect package managers, test frameworks, linters
- Generate appropriate scripts in `.polkacodes.yml`
- Identify project rules and conventions

### 2. Basic Script Template

Create a simple script template (no AI):

```bash
bun run polka init script my-script
```

This creates `.polka-scripts/my-script.ts` with a basic template.

### 3. AI-Assisted Script Generation ‚≠ê NEW

Generate custom scripts with AI assistance and interactive prompts:

```bash
# Interactive - AI will prompt for requirements
bun run polka init script my-script --ai

# With instructions provided
bun run polka init script my-script --ai --instructions "Review and commit changes in a loop"

# Non-interactive with all details
bun run polka init script my-script --ai --instructions "Fix linting errors" --yes
```

#### What Happens During AI Script Generation

1. **Analysis Phase**
   - AI reads your project structure
   - Understands your codebase and dependencies
   - Identifies relevant files and patterns

2. **Question Phase** (interactive mode only)
   - AI asks clarifying questions if needed
   - You can provide additional context
   - AI confirms understanding before proceeding

3. **Planning Phase**
   - AI presents a detailed plan
   - Shows the script approach and structure
   - Lists the main steps and workflows to use

4. **Confirmation Phase**
   - You review the proposed plan
   - Options: `yes` (proceed), `no` (cancel), `edit` (provide feedback)
   - AI refines based on your feedback

5. **Generation Phase**
   - AI generates complete TypeScript script
   - Uses polka workflows (code, fix, review, commit, plan)
   - Includes proper error handling and logging
   - Adds comments and usage examples

6. **Configuration Phase**
   - Script is saved to `.polka-scripts/`
   - Config is automatically updated if needed
   - Usage instructions are displayed

### 4. Skill Creation

Create Agent Skills:

```bash
bun run polka init skill my-skill
```

Creates `.claude/skills/my-skill/SKILL.md` with a template.

## Examples

### Example 1: Review-and-Commit Loop

```bash
bun run polka init script review-commit --ai --instructions "
Create a script that:
1. Reviews the last 10 commits
2. If issues are found, fixes them automatically
3. Commits the fixes
4. Repeats until no more issues
"
```

The AI will generate a script like:

```typescript
// Generated by polka.codes
import { review, fix, commit } from '@polka-codes/cli'

export interface ReviewCommitOptions {
  maxIterations?: number
  autoFix?: boolean
}

export async function main(args: string[]) {
  const maxIterations = 10

  for (let i = 0; i < maxIterations; i++) {
    console.log(`\n${'='.repeat(60)}`)
    console.log(`Review-Fix Cycle ${i + 1}/${maxIterations}`)
    console.log('='.repeat(60))

    // Review changes
    const reviewResult = await review({ range: 'HEAD~10..HEAD' })

    if (reviewResult.specificReviews.length === 0) {
      console.log('‚úÖ No issues found!')
      break
    }

    console.log(`‚ö†Ô∏è Found ${reviewResult.specificReviews.length} issues`)

    // Fix issues
    await fix({ task: 'Fix the issues from review' })

    // Commit fixes
    await commit({ all: true })
    console.log('‚úÖ Fixes committed')
  }

  console.log('\n‚úÖ All issues resolved!')
}

if (import.meta.main) {
  main(process.argv.slice(2))
}
```

### Example 2: Pre-Commit Checker

```bash
bun run polka init script precommit --ai --instructions "
Create a pre-commit hook that:
1. Runs typecheck
2. Runs linter
3. Runs tests
4. Blocks commit if anything fails
5. Provides clear error messages
"
```

### Example 3: Continuous Improvement

```bash
bun run polka init script improve --ai --instructions "
Create a continuous improvement script that:
1. Reviews recent changes (last 20 commits)
2. Identifies code quality issues
3. Suggests and applies improvements
4. Updates documentation
5. Commits improvements with clear messages
Runs in a loop until no more improvements are found.
"
```

### Example 4: Deployment Script

```bash
bun run polka init script deploy --ai --instructions "
Create a deployment script that:
1. Runs tests to ensure everything works
2. Builds the project
3. Runs linter
4. Creates a git tag with version number
5. Pushes to repository
Make it interactive - ask for confirmation before actually deploying.
"
```

## Interactive Features

### Asking Questions

The AI can ask you questions during script generation:

```
ü§ñ AI: What should the script do if tests fail?

Options:
1. Skip the test and continue
2. Fix the tests automatically
3. Exit with error
4. Let me decide each time

Your choice: _
```

### Plan Confirmation

Before generating the script, AI shows the plan:

```
üìã Script Generation Plan:

I will create a TypeScript script that automates code review and commit:

Steps:
1. Check if there are any changes to review
2. Review the last 10 commits using polka review
3. If critical issues found:
   a. Use polka fix to resolve issues
   b. Re-review to verify fixes
4. If no critical issues:
   a. Use polka commit to create commit
   b. Continue to next iteration
5. Repeat until no more changes or max iterations reached

The script will use these polka workflows:
- review: To analyze code changes
- fix: To automatically fix issues
- commit: To create commits with AI messages

Approach: Conservative - will ask for confirmation before critical operations

Do you want to proceed with generating this script? (yes/no/edit)
```

## Generated Script Features

Scripts generated by AI include:

- ‚úÖ **Type-safe**: Full TypeScript with proper types
- ‚úÖ **Error handling**: Try-catch blocks with clear error messages
- ‚úÖ **Logging**: Informative console output for progress tracking
- ‚úÖ **Configurable**: Accept command-line arguments
- ‚úÖ **Well-documented**: Comments explaining each step
- ‚úÖ **Reusable**: Export functions that can be imported elsewhere
- ‚úÖ **Executable**: Can be run directly or imported as a module

## Running Generated Scripts

After generation, run scripts with:

```bash
# Direct execution
bun run polka run my-script

# With arguments
bun run polka run my-script --maxIterations 5

# Import in other code
import { main } from './.polka-scripts/my-script'
await main(['--some-arg'])
```

## Advanced Usage

### Custom Configuration

The AI can also update your `.polkacodes.yml` configuration:

```bash
bun run polka init script custom --ai --instructions "
Create a script that runs tests in watch mode.
Update config to add a 'test:watch' script.
"
```

### Multiple Scripts

Create multiple related scripts:

```bash
bun run polka init script check --ai --instructions "Typecheck and lint"
bun run polka init script fix-all --ai --instructions "Fix all issues automatically"
bun run polka init script verify --ai --instructions "Verify changes before commit"
```

Then create a master script that calls them in sequence.

### Non-Interactive Mode

For CI/CD or automation:

```bash
bun run polka init script my-script \
  --ai \
  --instructions "Fix linting errors" \
  --yes
```

This skips all prompts and uses sensible defaults.

## Tips for Best Results

1. **Be Specific**: Provide clear, detailed instructions
2. **Mention Workflows**: Specify which polka workflows to use (code, fix, review, commit, plan)
3. **Describe Flow**: Explain the step-by-step process
4. **Mention Constraints**: Any limitations or requirements
5. **Provide Context**: Background about your project

Good instruction examples:
- ‚úÖ "Review, fix, and commit changes in a loop until clean"
- ‚úÖ "Run tests, if they fail fix them, then retry up to 3 times"
- ‚úÖ "Check for TypeScript errors and lint issues, fix them, run typecheck again"

Poor instruction examples:
- ‚ùå "Make it better"
- ‚ùå "Fix stuff"
- ‚ùå "Do magic"

## Troubleshooting

### Script Not Generated

Check:
- Provider is configured: `bun run polka init`
- API key is set up
- Script name doesn't conflict with built-in commands

### Script Has Errors

The AI may make mistakes. You can:
1. Run `polka fix` on the generated script
2. Manually edit the script
3. Regenerate with more specific instructions

### Can't Run Script

Check:
- Script is in `.polka-scripts/` directory
- Config has script entry
- TypeScript is installed: `bun install -g typescript`

## Comparison: Basic vs AI Generation

| Feature | Basic Template | AI-Assisted |
|---------|---------------|--------------|
| Setup time | Instant | 1-2 minutes |
| Customization | Manual | Interactive |
| Workflow integration | Manual | Automatic |
| Error handling | Basic | Comprehensive |
| Documentation | Minimal | Detailed |
| Best for | Simple scripts | Complex automation |

## Next Steps

After generating a script:

1. **Review the script**: Check `.polka-scripts/<name>.ts`
2. **Test it**: `bun run polka run <name>`
3. **Customize**: Edit if needed
4. **Add to CI**: Integrate into your CI/CD pipeline
5. **Share with team**: Commit to repository

## Examples Repository

See `examples/review-fix-commit.ts` for a complete example of an AI-generated workflow script.
