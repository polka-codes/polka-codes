// generated by polka.codes

import type { Writable } from 'node:stream'
import { formatWithOptions } from 'node:util'
import type { Logger } from '@polka-codes/core'

function createStreamConsole(stdout: Writable, stderr: Writable) {
  const isStdoutTTY = 'isTTY' in stdout && (stdout as { isTTY?: boolean }).isTTY
  const isStderrTTY = 'isTTY' in stderr && (stderr as { isTTY?: boolean }).isTTY

  return {
    log: (...args: unknown[]) => stdout.write(`${formatWithOptions({ colors: isStdoutTTY }, ...args)}\n`),
    info: (...args: unknown[]) => stdout.write(`${formatWithOptions({ colors: isStdoutTTY }, ...args)}\n`),
    warn: (...args: unknown[]) => stderr.write(`${formatWithOptions({ colors: isStderrTTY }, ...args)}\n`),
    error: (...args: unknown[]) => stderr.write(`${formatWithOptions({ colors: isStderrTTY }, ...args)}\n`),
  }
}

export const createLogger = (options: { verbose?: number; stream?: Writable }): Logger => {
  const { verbose = 0, stream = process.stderr } = options
  const con = createStreamConsole(stream, stream)

  if (verbose < 0) {
    return {
      debug: () => {},
      info: () => {},
      warn: () => {},
      error: () => {},
    }
  }

  return {
    debug: (...args: unknown[]) => {
      if (verbose >= 1) {
        con.log(...args)
      }
    },
    info: (...args: unknown[]) => {
      con.info(...args)
    },
    warn: (...args: unknown[]) => {
      con.warn(...args)
    },
    error: (...args: unknown[]) => {
      con.error(...args)
    },
  }
}
