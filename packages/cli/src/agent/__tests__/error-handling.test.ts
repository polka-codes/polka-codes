// Generated by polka.codes

/**
 * Test to verify error classes preserve stack traces correctly
 *
 * Run with: npm test -- error-handling.test.ts
 */

import { CommandExecutionError, FileSystemAccessError, JSONParseError } from '../error-handling.js'

function testFileSystemError() {
  console.log('\n=== Testing FileSystemAccessError ===')

  try {
    throw new FileSystemAccessError('/test/path.txt', 'read')
  } catch (error) {
    if (error instanceof Error) {
      console.log('Error name:', error.name)
      console.log('Error message:', error.message)
      console.log('\nStack trace:')
      console.log(error.stack)

      // Verify the stack trace contains the actual error class name
      if (error.stack?.includes('FileSystemAccessError')) {
        console.log('✅ Stack trace contains error class name')
      } else {
        console.log('❌ Stack trace does NOT contain error class name')
      }

      // Verify instanceof works
      if (error instanceof FileSystemAccessError) {
        console.log('✅ instanceof check works')
      } else {
        console.log('❌ instanceof check FAILED')
      }
    }
  }
}

function testCommandExecutionError() {
  console.log('\n=== Testing CommandExecutionError ===')

  try {
    throw new CommandExecutionError('npm install', 1, 'Error: package not found')
  } catch (error) {
    if (error instanceof Error) {
      console.log('Error name:', error.name)
      console.log('Error message:', error.message)
      console.log('\nStack trace:')
      console.log(error.stack)

      if (error.stack?.includes('CommandExecutionError')) {
        console.log('✅ Stack trace contains error class name')
      } else {
        console.log('❌ Stack trace does NOT contain error class name')
      }
    }
  }
}

function testJSONParseError() {
  console.log('\n=== Testing JSONParseError ===')

  try {
    throw new JSONParseError('/test/config.json', new Error('Unexpected token'))
  } catch (error) {
    if (error instanceof Error) {
      console.log('Error name:', error.name)
      console.log('Error message:', error.message)
      console.log('Cause:', error.cause)
      console.log('\nStack trace:')
      console.log(error.stack)

      if (error.stack?.includes('JSONParseError')) {
        console.log('✅ Stack trace contains error class name')
      } else {
        console.log('❌ Stack trace does NOT contain error class name')
      }

      if (error.cause) {
        console.log('✅ Cause chain preserved')
      } else {
        console.log('❌ Cause chain NOT preserved')
      }
    }
  }
}

// Run all tests
testFileSystemError()
testCommandExecutionError()
testJSONParseError()

console.log('\n=== All tests complete ===\n')
