// generated by polka.codes

import type { AgentNameType } from '@polka-codes/core'
import type { Workflow } from '@polka-codes/workflow'
import type { CliToolRegistry } from '../workflow-tools'

export type AgentWorkflowInput = {
  task: string
  agent: string
}

export const agentWorkflow: Workflow<AgentWorkflowInput, { success: boolean }, CliToolRegistry> = {
  name: 'Agent Task',
  description: 'Run a specific agent with a given task.',
  async *fn(input, _step, tools) {
    const { task, agent } = input

    console.log(`\nðŸ¤– Invoking agent: ${agent}...\n`)

    const messages = [{ type: 'user' as const, content: task }]

    yield* tools.invokeAgent({
      agent: agent as AgentNameType,
      messages,
      defaultContext: true,
    })

    console.log('\nâœ… Agent finished!\n')

    return { success: true }
  },
}
