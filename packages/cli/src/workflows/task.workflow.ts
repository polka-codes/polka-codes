// generated by polka.codes

import type { AgentNameType } from '@polka-codes/core'
import type { WorkflowFn } from '@polka-codes/workflow'
import type { CliToolRegistry } from '../workflow-tools'

export type TaskWorkflowInput = {
  task: string
  agent: string
}

export const taskWorkflow: WorkflowFn<TaskWorkflowInput, { success: boolean }, CliToolRegistry> = async (
  input,
  { toolHandler, logger },
) => {
  const { task, agent } = input

  logger.info(`\nðŸ¤– Invoking agent: ${agent}...\n`)

  const messages = [{ type: 'user' as const, content: task }]

  await toolHandler.invokeAgent({
    agent: agent as AgentNameType,
    messages,
    defaultContext: true,
  })

  logger.info('\nâœ… Agent finished!\n')

  return { success: true }
}
