// Unit tests for MCP server
// generated by polka.codes

import { describe, expect, test } from 'bun:test'
import { McpServer } from './server'

describe('McpServer', () => {
  test('should initialize with default config', () => {
    const server = new McpServer({
      serverInfo: {
        name: 'test-server',
        version: '1.0.0',
      },
      capabilities: {
        tools: true,
      },
    })

    expect(server.getToolsCount()).toBe(0)
    expect(server.getResourcesCount()).toBe(0)
    expect(server.isInitialized()).toBe(false)
  })

  test('should register tools', () => {
    const server = new McpServer({
      serverInfo: {
        name: 'test-server',
        version: '1.0.0',
      },
      capabilities: {
        tools: true,
      },
    })

    server.registerTool({
      name: 'test_tool',
      description: 'A test tool',
      inputSchema: {
        type: 'object',
        properties: {
          arg1: { type: 'string' },
        },
      },
      handler: async (args) => {
        return { result: args }
      },
    })

    expect(server.getToolsCount()).toBe(1)
  })

  test('should register multiple tools', () => {
    const server = new McpServer({
      serverInfo: {
        name: 'test-server',
        version: '1.0.0',
      },
      capabilities: {
        tools: true,
      },
    })

    server.registerTools([
      {
        name: 'tool1',
        description: 'Tool 1',
        inputSchema: {},
        handler: async () => ({}),
      },
      {
        name: 'tool2',
        description: 'Tool 2',
        inputSchema: {},
        handler: async () => ({}),
      },
    ])

    expect(server.getToolsCount()).toBe(2)
  })

  test('should register resources', () => {
    const server = new McpServer({
      serverInfo: {
        name: 'test-server',
        version: '1.0.0',
      },
      capabilities: {
        resources: true,
      },
    })

    server.registerResource({
      uri: 'file:///test.txt',
      name: 'Test File',
      description: 'A test file',
      mimeType: 'text/plain',
      handler: async () => 'content',
    })

    expect(server.getResourcesCount()).toBe(1)
  })

  test('should register multiple resources', () => {
    const server = new McpServer({
      serverInfo: {
        name: 'test-server',
        version: '1.0.0',
      },
      capabilities: {
        resources: true,
      },
    })

    server.registerResources([
      {
        uri: 'file:///test1.txt',
        name: 'Test 1',
        handler: async () => 'content1',
      },
      {
        uri: 'file:///test2.txt',
        name: 'Test 2',
        handler: async () => 'content2',
      },
    ])

    expect(server.getResourcesCount()).toBe(2)
  })
})
