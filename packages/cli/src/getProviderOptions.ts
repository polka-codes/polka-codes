// generated by polka.codes

import { AiProvider } from './getModel'
import models from './prices'

export type GetProviderOptionsArgs = {
  provider: AiProvider
  modelId: string
  parameters?: {
    thinkingBudgetTokens?: number
    [key: string]: any
  }
  supportThinking?: boolean
}

/**
 * Generates provider-specific options for enabling thinking capabilities.
 *
 * @param options The options for generating provider options.
 * @returns A provider options object for the `streamText` call.
 */
export function getProviderOptions(options: GetProviderOptionsArgs): Record<string, any> {
  const { provider, modelId, parameters, supportThinking } = options
  const thinkingBudgetTokens = parameters?.thinkingBudgetTokens ?? 0

  if (thinkingBudgetTokens <= 0 || !provider || !modelId) {
    return {}
  }

  const modelInfo = (models[provider as keyof typeof models] as Record<string, any>)?.[modelId]
  const providerSupportsThinking = provider === AiProvider.OpenRouter || !!modelInfo?.supportsThinking
  const shouldSupportThinking = supportThinking ?? providerSupportsThinking

  if (!shouldSupportThinking) {
    return {}
  }

  const providerOptions: any = {}

  switch (provider) {
    case AiProvider.Anthropic:
      providerOptions.anthropic = {
        thinking: { type: 'enabled', budgetTokens: thinkingBudgetTokens },
      }
      break
    case AiProvider.OpenRouter:
      if (modelId.startsWith('anthropic/')) {
        // TODO: support thinking for anthropic models
        // openrouter ai sdk doesn't appear to expose reasining details
        // so we can't construct multi step messages correctly when thinking is enabled
        break
      }
      providerOptions.openrouter = {
        reasoning: {
          max_tokens: thinkingBudgetTokens,
        },
      }
      break
    case AiProvider.GoogleVertex:
    case AiProvider.Google:
      providerOptions.google = {
        thinkingConfig: {
          includeThoughts: true,
          thinkingBudget: thinkingBudgetTokens,
        },
      }
      break
    case AiProvider.Ollama:
      break
    case AiProvider.DeepSeek:
      break
    case AiProvider.OpenAI:
      break
  }

  return providerOptions
}
