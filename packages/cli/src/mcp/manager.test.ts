// Unit tests for MCP manager
// generated by polka.codes

import { describe, expect, test } from 'bun:test'
import { McpConnectionError, McpServerError } from './errors'
import { McpManager } from './manager'

describe('McpManager', () => {
  test('should initialize without servers', () => {
    const manager = new McpManager()
    expect(manager.listConnectedServers()).toEqual([])
    expect(manager.isServerConnected('test-server')).toBe(false)
  })

  test('should throw error when trying to disconnect non-existent server', async () => {
    const manager = new McpManager()
    expect(manager.disconnectServer('non-existent')).rejects.toThrow(McpServerError)
  })

  test('should return empty tools map when no servers connected', () => {
    const manager = new McpManager()
    expect(manager.getAllTools().size).toBe(0)
  })

  test('should return false for hasTool when no servers connected', () => {
    const manager = new McpManager()
    expect(manager.hasTool('some-tool')).toBe(false)
  })

  test('should return undefined for getTool when tool does not exist', () => {
    const manager = new McpManager()
    expect(manager.getTool('some-tool')).toBeUndefined()
  })

  test('should handle empty server config', async () => {
    const manager = new McpManager()
    await manager.connectToServers({})
    expect(manager.listConnectedServers()).toEqual([])
  })

  test('should fail to connect to server without command', async () => {
    const manager = new McpManager()
    expect(
      manager.connectToServer('test-server', {
        command: undefined as any,
      }),
    ).rejects.toThrow(McpConnectionError)
  })
})
