// Generated by polka.codes
// Defines Zod schemas for WebSocket message validation in the runner.

import { z } from 'zod'

export const wsIncomingMessageSchema = z.discriminatedUnion('type', [
  z.object({
    type: z.literal('pending_tools'),
    step: z.number(),
    requests: z.array(
      z.object({
        index: z.number(),
        tool: z.string(),
        params: z.any(),
      }),
    ),
  }),
  z.object({ type: z.literal('get_files') }),
  z.object({ type: z.literal('done') }),
])

export type WsIncomingMessage = z.infer<typeof wsIncomingMessageSchema>

export const wsOutgoingMessageSchema = z.discriminatedUnion('type', [
  z.object({
    type: z.literal('pending_tools_response'),
    step: z.number(),
    responses: z.array(
      z.object({
        index: z.number(),
        tool: z.string(),
        response: z.string(),
      }),
    ),
  }),
  z.object({
    type: z.literal('file'),
    path: z.string(),
    content: z.string(),
  }),
  z.object({
    type: z.literal('file_deleted'),
    path: z.string(),
  }),
  z.object({
    type: z.literal('get_files_completed'),
  }),
  z.object({
    type: z.literal('error'),
    message: z.string(),
    details: z.string().optional(),
  }),
])

export type WsOutgoingMessage = z.infer<typeof wsOutgoingMessageSchema>
