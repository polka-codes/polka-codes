// Generated by polka.codes

/**
 * Base error class that preserves error name in stack traces
 *
 * All custom errors should extend this class to ensure:
 * - Proper stack trace with error name
 * - Cause chain support
 * - Consistent error handling
 */
export class BaseError extends Error {
  constructor(
    public name: string,
    message: string,
    public cause?: Error,
  ) {
    super(message)
    this.name = name // Preserves error name in stack traces
    if (cause) {
      this.cause = cause
    }
    // Maintains proper stack trace
    if (Error.captureStackTrace) {
      Error.captureStackTrace(this, this.constructor)
    }
  }
}

/**
 * Factory that creates NAMED error classes (not anonymous) for proper stack traces
 *
 * The factory returns a named class that extends BaseError.
 * Stack traces will show the actual error class name, not "BaseError" or "createErrorClass".
 *
 * @example
 * ```typescript
 * export const FileSystemAccessError = createErrorClass(
 *   'FileSystemAccessError',
 *   ([path, operation]: [string, string]) => `Failed to ${operation} ${path}`
 * )
 *
 * // Stack trace will show: "at new FileSystemAccessError"
 * // NOT: "at new createErrorClass" or "at new BaseError"
 * ```
 */
export function createErrorClass<T extends any[]>(name: string, template: (args: T) => string): new (...args: T) => BaseError {
  // Create a named class for proper stack traces
  class NamedError extends BaseError {
    constructor(...args: T) {
      // Build the error message from all arguments
      const message = template(args)

      // Extract cause from last argument if it's an Error
      const lastArg = args[args.length - 1]
      const cause = lastArg instanceof Error ? lastArg : undefined

      super(name, message, cause)
    }
  }

  // Set the name property explicitly for stack traces
  Object.defineProperty(NamedError, 'name', { value: name })

  return NamedError as any
}
