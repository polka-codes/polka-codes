/**
 * Utility to compute exponential backoff delays for rate-limit handling. generated by polka.codes
 *
 * The backoff starts at baseSeconds and doubles each time, capped at capSeconds.
 * Example with base=2, cap=60: 2, 4, 8, 16, 32, 60, 60, ...
 */
export function computeRateLimitBackoffSeconds(count: number, baseSeconds = 2, capSeconds = 60): number {
  if (!Number.isFinite(count) || count <= 0) {
    // Treat non-positive or invalid counts as first occurrence
    count = 1
  }
  if (!Number.isFinite(baseSeconds) || baseSeconds <= 0) {
    baseSeconds = 2
  }
  if (!Number.isFinite(capSeconds) || capSeconds <= 0) {
    capSeconds = 60
  }

  const delay = baseSeconds * 2 ** (count - 1)
  return Math.min(delay, capSeconds)
}
