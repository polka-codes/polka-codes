// Bun Snapshot v1, https://goo.gl/fbAQLP

exports[`TruncateContextPolicy should truncate messages when over threshold 1`] = `
[
  {
    "content": "User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1",
    "role": "user",
  },
  {
    "content": "Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1",
    "role": "assistant",
  },
  {
    "content": "User message 2",
    "role": "user",
  },
  {
    "content": "Assistant message 2",
    "role": "assistant",
  },
  {
    "content": "User message 3",
    "role": "user",
  },
  {
    "content": "Assistant message 3",
    "role": "assistant",
  },
]
`;

exports[`TruncateContextPolicy should preserve messages from start and end 1`] = `
[
  {
    "content": "Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1Old user message 1",
    "role": "user",
  },
  {
    "content": "Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1Old assistant message 1",
    "role": "assistant",
  },
  {
    "content": "Note: 5 messages were truncated from the middle to prevent context overflow.",
    "role": "user",
  },
  {
    "content": "Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2Middle assistant message 2",
    "role": "assistant",
  },
  {
    "content": "Recent user message",
    "role": "user",
  },
  {
    "content": "Recent assistant message",
    "role": "assistant",
  },
]
`;

exports[`TruncateContextPolicy should use maxTokens parameter when provided 1`] = `
[
  {
    "content": "User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1",
    "role": "user",
  },
  {
    "content": "Note: 2 messages were truncated from the middle to prevent context overflow.",
    "role": "user",
  },
  {
    "content": "Assistant message 2",
    "role": "assistant",
  },
]
`;

exports[`TruncateContextPolicy should use thinkingBudgetTokens as fallback 1`] = `
[
  {
    "content": "User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1",
    "role": "user",
  },
  {
    "content": "Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1Assistant message 1",
    "role": "assistant",
  },
  {
    "content": "User message 2",
    "role": "user",
  },
  {
    "content": "Assistant message 2",
    "role": "assistant",
  },
]
`;

exports[`TruncateContextPolicy should prefer maxTokens over thinkingBudgetTokens 1`] = `
[
  {
    "content": "User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1User message 1",
    "role": "user",
  },
  {
    "content": "Note: 2 messages were truncated from the middle to prevent context overflow.",
    "role": "user",
  },
  {
    "content": "Assistant message 2",
    "role": "assistant",
  },
]
`;

exports[`TruncateContextPolicy should truncate exactly half of messages 1`] = `
[
  {
    "content": "Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1Message 1",
    "role": "user",
  },
  {
    "content": "Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1Response 1",
    "role": "assistant",
  },
  {
    "content": "Note: 4 messages were truncated from the middle to prevent context overflow.",
    "role": "user",
  },
  {
    "content": "Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4Message 4",
    "role": "user",
  },
  {
    "content": "Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4Response 4",
    "role": "assistant",
  },
]
`;
