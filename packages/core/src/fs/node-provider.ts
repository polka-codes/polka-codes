// generated by polka.codes

import { existsSync } from 'node:fs'
import { readdir, readFile, stat } from 'node:fs/promises'
import { join, normalize } from 'node:path'
import type { DirectoryEntry, FileStats, FileSystemProvider, FileSystemProviderOptions } from './provider'

/**
 * Node.js file system provider implementation
 * Uses the node:fs module for file operations
 */
export class NodeFileSystemProvider implements FileSystemProvider {
  constructor(readonly _options: FileSystemProviderOptions = {}) {}

  exists(path: string): boolean {
    return existsSync(path)
  }

  async readdir(path: string): Promise<DirectoryEntry[]> {
    const entries = await readdir(path, { withFileTypes: true })
    return entries.map((entry) => ({
      name: entry.name,
      isDirectory: entry.isDirectory(),
      isFile: entry.isFile(),
    }))
  }

  async readFile(path: string): Promise<string> {
    return readFile(path, 'utf-8')
  }

  async readFileAsBuffer(path: string): Promise<Uint8Array> {
    const buffer = await readFile(path)
    return new Uint8Array(buffer)
  }

  async stat(path: string): Promise<FileStats> {
    const stats = await stat(path)
    return {
      size: stats.size,
      isDirectory: stats.isDirectory(),
      isFile: stats.isFile(),
    }
  }

  join(...paths: string[]): string {
    return join(...paths)
  }

  normalize(path: string): string {
    return normalize(path)
  }
}
