// Generated by polka.codes
// Tests for the renameFile tool

import { describe, expect, it, spyOn } from 'bun:test'
import { MockProvider } from './provider'
import renameFile from './renameFile'

describe('renameFile', () => {
  it('should rename file successfully', async () => {
    const mockProvider = new MockProvider()
    spyOn(mockProvider, 'renameFile').mockResolvedValue()

    const result = await renameFile.handler(mockProvider, {
      sourcePath: 'old.txt',
      targetPath: 'new.txt',
    })

    expect(result).toMatchSnapshot()
    expect(mockProvider.renameFile).toHaveBeenCalledWith('old.txt', 'new.txt')
  })

  it('should handle rename errors', async () => {
    const mockProvider = new MockProvider()
    spyOn(mockProvider, 'renameFile').mockRejectedValue(new Error('Rename error'))

    const result = renameFile.handler(mockProvider, {
      sourcePath: 'error.txt',
      targetPath: 'new.txt',
    })

    expect(result).rejects.toMatchSnapshot()
    expect(mockProvider.renameFile).toHaveBeenCalledWith('error.txt', 'new.txt')
  })

  it('should handle unavailable provider', async () => {
    const mockProvider = new MockProvider()
    // @ts-ignore
    mockProvider.renameFile = undefined

    expect(renameFile.isAvailable(mockProvider)).toBe(false)

    const result = await renameFile.handler(mockProvider, {
      sourcePath: 'test.txt',
      targetPath: 'new.txt',
    })

    expect(result).toMatchSnapshot()
  })
})
