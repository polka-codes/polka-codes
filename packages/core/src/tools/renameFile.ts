// Generated by polka.codes
// Tool for renaming files in the filesystem

import { type FullToolInfo, PermissionLevel, type ToolHandler, type ToolInfo, ToolResponseType } from '../tool'
import type { FilesystemProvider } from './provider'
import { getString } from './utils'

export const toolInfo = {
  name: 'rename_file',
  description: 'Request to rename a file from source path to target path.',
  parameters: [
    {
      name: 'source_path',
      description: 'The current path of the file',
      required: true,
      usageValue: 'Source file path here',
    },
    {
      name: 'target_path',
      description: 'The new path for the file',
      required: true,
      usageValue: 'Target file path here',
    },
  ],
  examples: [
    {
      description: 'Request to rename a file',
      parameters: [
        {
          name: 'source_path',
          value: 'src/old-name.js',
        },
        {
          name: 'target_path',
          value: 'src/new-name.js',
        },
      ],
    },
  ],
  permissionLevel: PermissionLevel.Write,
} as const satisfies ToolInfo

export const handler: ToolHandler<typeof toolInfo, FilesystemProvider> = async (provider, args) => {
  if (!provider.renameFile) {
    return {
      type: ToolResponseType.Error,
      message: 'Not possible to rename file. Abort.',
    }
  }

  const sourcePath = getString(args, 'source_path')
  const targetPath = getString(args, 'target_path')

  await provider.renameFile(sourcePath, targetPath)

  return {
    type: ToolResponseType.Reply,
    message: `<rename_file_path>${targetPath}</rename_file_path><status>Success</status>`,
  }
}

export const isAvailable = (provider: FilesystemProvider): boolean => {
  return !!provider.renameFile
}

export default {
  ...toolInfo,
  handler,
  isAvailable,
} satisfies FullToolInfo
