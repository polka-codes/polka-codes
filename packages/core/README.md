# Polka Codes Core

[![npm version](https://img.shields.io/npm/v/@polka-codes/core.svg)](https://www.npmjs.com/package/@polka-codes/core)
[![npm downloads](https://img.shields.io/npm/dm/@polka-codes/core.svg)](https://www.npmjs.com/package/@polka-codes/core)
[![License](https://img.shields.io/npm/l/@polka-codes/core.svg)](https://github.com/polkacodes/polkacodes/blob/main/LICENSE)

Core AI services and agent implementations for Polka Codes framework.

## Features

- Multiple AI provider support (Ollama, Anthropic, DeepSeek)
- Extensible agent architecture
- Tool integration system
- Type-safe API
- Logging and monitoring

## Installation

```bash
bun add @polka-codes/core
```

## Usage

### Basic Setup

```typescript
import { AgentBase } from '@polka-codes/core';

class MyAgent extends AgentBase {
  // Implement your agent logic
}

const agent = new MyAgent();
await agent.runTask('your-task');
```

### Available Services

- `AnthropicService`: Integration with Anthropic API
- `DeepSeekService`: Integration with DeepSeek API
- `OllamaService`: Integration with Ollama API

### Tools

The core package provides a tool system for extending functionality:

```typescript
import { ToolBase } from '@polka-codes/core';

class MyTool extends ToolBase {
  // Implement your tool logic
}
```

### Nested workflows

You can reuse existing workflows inside other workflows with the `workflow` step. This is helpful when you want to repeat a
common CLI pattern such as `custom → agent → custom`.

```typescript
import {
  builder,
  combineHandlers,
  customStepSpecHandler,
  makeAgentStepSpecHandler,
  sequentialStepSpecHandler,
  workflowStepSpecHandler,
} from '@polka-codes/core/workflow';

const reviewWorkflow = builder<{ code: string }>()
  .custom('prepare', async ({ code }) => ({ prompt: `Review this snippet:\n${code}` }))
  .agent('agent', {
    messages: [{ type: 'function', fn: (input) => input.prompt }],
    systemPrompt: 'You are a careful reviewer.',
    parseOutput: (raw) => ({ success: true, data: { review: raw } }),
  })
  .custom('summarize', async (input) => ({ summary: input.review }))
  .build();

const mainWorkflow = builder<{ code: string; notify: boolean }>()
  .workflow('review', {
    workflow: reviewWorkflow,
    mapInput: (input) => ({ code: input.code }),
    mapOutput: ({ workflowOutput, input }) => ({ summary: workflowOutput.summary, notify: input.notify }),
  })
  .custom('finalize', async ({ summary, notify }) => ({ summary, notified: notify }))
  .build();

const handlers = combineHandlers(
  sequentialStepSpecHandler,
  customStepSpecHandler,
  workflowStepSpecHandler,
  makeAgentStepSpecHandler(async () => /* return a LanguageModelV2 */ throw new Error('model not configured')),
);
```

The optional `mapInput` and `mapOutput` helpers let you shape data for the child workflow and massage the result before the
next parent step runs.

## Development

### Building

```bash
cd packages/core
bun run build
```

### Testing

```bash
bun test
```

---

*This README was generated by polka.codes*
