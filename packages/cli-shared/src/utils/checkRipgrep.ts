// generated by polka.codes
import { spawnSync } from 'node:child_process'

const rgAvailability = {
  isAvailable: null as boolean | null,
}

/**
 * Checks if ripgrep (rg) is installed and available in the system's PATH.
 * Caches the result to avoid repeated checks.
 */
export function checkRipgrep(): boolean {
  if (rgAvailability.isAvailable !== null) {
    return rgAvailability.isAvailable
  }

  const rg = spawnSync('rg', ['--version'])

  if (rg.error || rg.status !== 0) {
    rgAvailability.isAvailable = false
    return false
  }

  rgAvailability.isAvailable = true
  return true
}
